---
title: 'Pressure review'
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
  code_folding: show
toc: true
toc_depth: 3
toc_float: yes
number_sections: false
theme: cerulean
highlight: haddock
includes: 
  in_header: '../../../ohiprep_v2018/src/templates/ohi_hdr.html'
pdf_document:
  toc: true
---

```{r setup, message=FALSE, warning=FALSE, verbose=FALSE, error=FALSE, echo=FALSE, results='hide'}

#set options for all chunks in code
 knitr::opts_chunk$set(warning=FALSE, message=FALSE, fig.align = "center", fig.width=8, fig.height =4.5)
#knitr::opts_chunk$set(warning=FALSE, message=FALSE)

#libraries
library(raster)
library(ncdf4)
library(RColorBrewer)
library(sf)
library(dplyr)
library(fields)

source("https://raw.githubusercontent.com/OHI-Science/ohiprep_v2018/master/src/R/spatial_common.R")

regions_shape <- as(regions, "Spatial")
land <- regions_shape[regions_shape$rgn_type %in% c("land", "land-disputed", "land-noeez"), ]

## function to make plots

legend.shrink <- 0.4
legend.width <- 0.6


raster_breaks <- function(raster_data, title, title_legend=NULL, myBreaks, cols){
  par(mar=c(2,2,2,2)) # bottom, left, top, and right
  par(oma=c(0,0,0,4))
plot(raster_data, col=cols, axes=FALSE, box=FALSE, breaks=myBreaks, legend=FALSE)
  title(title, line=0)
# add axis with fields package function:
def_breaks <- seq(0, length(myBreaks), length.out=length(myBreaks))
image.plot(raster_data, #zlim = c(min(myBreaks), max(myBreaks)), 
           legend.only = TRUE, 
           legend.shrink=legend.shrink,
           legend.width=legend.width,
           col = cols,
           legend.lab=title_legend,
            breaks=def_breaks,
           lab.breaks=c(NA, 0, NA, 0.2, NA, 0.4, NA, 0.6, NA, 0.8, NA, 1, NA, 2, NA, 3, NA, "Inf"),
           axis.args = list(cex.axis = 0.6))

#plot(land, add=TRUE, border="gray80", col="gray90", lwd=0.5)
#plot(raster_data, col=cols, axes=FALSE, box=FALSE, breaks=myBreaks, legend=FALSE, add=TRUE)
}

my_breaks <- c(-1, 0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.5, 2, 2.5, 3, 3.5, 100) 
cols = rev(colorRampPalette(brewer.pal(11, 'Spectral'))(length(my_breaks)-2))
cols = c(NA, cols)


# setwd("stressors")

```

  
# Summary
The following are the individual pressures between 2003 and 2013.  

***
  
# Fishing pressures

## Artisanal Fishing

```{r artisanal, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}


for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/art_fish_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```


## Pelagic high bycatch

```{r pel_hb, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/pel_hb_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)

}



```

## Pelagic low bycatch

```{r pel_lb, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/pel_lb_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)

}

```


## Demersal destructive

```{r dem_des, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/dem_dest_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```

## Demersal nondestructive high bycatch

```{r dem_nondest_hb, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/dem_nondest_hb_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```

## Demersal nondestructive low bycatch

```{r dem_nondest_lb, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/dem_nondest_lb_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```

# Climate change

## SLR
```{r slr, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/slr_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)

}

```

## SST
```{r sst, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/sst_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```

## OA
```{r oa, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/oa_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```

# Land-based

## Nutrient pollution runoff
```{r nutrient, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/nutrient_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```


## Organic pollution runoff
```{r organic, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/organic_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```

## Direct impacts (human population)
```{r human, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/direct_human_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)

}

```

## Light pollution
```{r light, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/light_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```

# Ocean pollution
## Shipping
```{r shipping, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2003:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/shipping_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```


# Etc
These are not included in the cumulative impacts due to limited years of data.  But we do want to make these data available.
## Benthic structures
```{r str, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2012:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/benthic_str_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)
}

```

## UV
```{r uv, message=FALSE, warning=FALSE, verbose=FALSE, echo=FALSE, error=FALSE}

for(year in 2010:2013){ # year = 2003
p_rast <- raster(file.path(dir_M, sprintf("git-annex/impact_acceleration/impact/stressor_impact/uv_%s.tif", year)))
raster_breaks(raster_data=p_rast,  
              myBreaks=my_breaks, cols=cols, title=year)

}

```
